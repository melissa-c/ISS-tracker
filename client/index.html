<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <title>ISS Tracker</title>
    <link href='https://fonts.googleapis.com/css?family=Rubik|Audiowide|Share+Tech+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  </head>

  <body>
  <div class="main">
    <div class="title">
      <h1>ISS TRACKER</h1>
      <h3>For International Space Station Stalkers</h3>
      <p>Enter details into Ground Control</p>
    </div>

<!-- ========== DISTANCE ========== -->
    <div class="distance">
      <p class="title">Distance between the ISS and your location:</p>
      <div class="kmpart">
        <p class="title">Kilometres:</p>
        <p class="km"></p>
      </div>
      <div class="mipart">
        <p class="title">Miles:</p>
        <p class="miles"></p>
      </div>
    </div>
<!-- ========== ISS ========== -->
    <div class="issCoords">
      <h2>ISS Control Centre</h2>
      <p class="title">Latitude:</p>
      <p class="lat"></p>
      <p class="title">Longitude:</p>
      <p class="long"></p>

      <div class="astronauts">
        <h3>Current Astronauts</h3>
        <ol class="astronauts">
        </ol>
      </div>
    </div>

<!-- ========== EARTH ========== -->
    <div class="earthCoords">
      <h2>Ground Control</h2>
      <p class="title">Latitude:</p>
      <p id="earthlat"></p>
      <p class="title">Longitude:</p>
      <p id="earthlong"></p>

      <div class="earth">
        <h3>Location on Earth</h3>
        <p>Enter an address below</p>
        <!-- shows error in console log because googlemaps only accepts input tags but ignore as this does not affect how it works -->
        <textarea id="address" type="text" placeholder="e.g.: 275 Cuba Street Wellington, NZ"></textarea>
        <br>
        <input id="submit" type="button" value="Get my location" onlick="deleteMarkers()">
      </div>
    </div>

<!-- ========== MAP ========== -->
    <div id="map"></div>
  </div>

  <script src="bundle.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?&libraries=places&callback=initMap">
  </script>
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js?&libraries=places"></script> -->
  <!-- <script src="https://maps.googleapis.com/maps/api/js?&libraries=places"></script> -->

  <script>
    function initMap() {
      var markers = []

      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 1,
        center: {lat: 19.897, lng: -155.583}
      });
      var geocoder = new google.maps.Geocoder();

      document.getElementById('submit').addEventListener('click', function() {
        geocodeAddress(geocoder, map);
        markers.splice(0, 1, marker);
      });
    
      var input = document.getElementById('address');

      var autocomplete = new google.maps.places.Autocomplete(input);
    

    // map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

    var infowindow = new google.maps.InfoWindow();
    var marker = new google.maps.Marker({
      map: map
    });

    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });

    autocomplete.addListener('place_changed', function() {
      infowindow.close();
      var place = autocomplete.getPlace();
      if (!place.geometry) {
        return;
      }

      if (place.geometry.viewport) {
        map.fitBounds(place.geometry.viewport);
      } else {
        map.setCenter(place.geometry.location);
        map.setZoom(5);
      }

      marker.setPlace({
        placeId: place.place_id,
        location: place.geometry.location
      });
      marker.setVisible(true);

      infowindow.setContent('<div><strong>' + place.name + '</strong><br>'/* +
          'Place ID: ' + place.place_id + '<br>'*/ +
          place.formatted_address);
      infowindow.open(map, marker);
    });
    }

    function geocodeAddress(geocoder, resultsMap) {
      var address = document.getElementById('address').value;
      geocoder.geocode({'address': address}, function(results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
          resultsMap.setCenter(results[0].geometry.location);
          var marker = new google.maps.Marker({
            map: resultsMap,
            position: results[0].geometry.location
          });
            var eLat = (results[0].geometry.location.lat()).toFixed(3)
            var eLong = (results[0].geometry.location.lng()).toFixed(3)
            $('#earthlat').text(eLat);
            $('#earthlong').text(eLong);
            getEarth(eLat, eLong)
        } else {
          alert('An error has occurred: ' + status);
        }
      });
    }

  </script>
  </body>
</html>
